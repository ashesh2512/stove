clc; close all; clear all;

%% problem properties
% % problem properties
% pp = containers.Map({            'prblm', 'dof per node', 'conductivity'}, ...
%                      { "steady heat MMS",              1,              1});
%                  
% % background mesh
% box1 = [-2,2; -2,2];
% h1   = [ 0.2,  0.2]/2/2/2;
% 
% % boundary condition map - bottom, right, top, left
% bc1 = containers.Map({   'bottom',     'right',       'top',      'left'}, ...
%                      {"dirichlet", "dirichlet", "dirichlet", "dirichlet"});
% % near body mesh
% box2 = [-1.13625,0.86375; -1.13625,0.86375];
% h2   = [             0.2,              0.2]/2/2/2;
% 
% % boundary condition map - bottom, right, top, left
% bc2 = containers.Map({ 'bottom',   'right',     'top',    'left'}, ...
%                      {"overset", "overset", "overset", "overset"});
%
% ov_info = containers.Map({ 'num grids', 'mesh1 donor', 'mesh2 donor', 'mandatory frng', 'overlap', 'donor grid', ...
%                            'intrp radius', 'intrp type', 'intrp shape', 'shape param', 'poly order', 'solve type'}, ...
%                          { 2, 2, 1, 2, [3*h2(1), 3*h2(1), 3*h2(1), 3*h2(1)], "radial", ...
%                            2.5*max(h2), "rbf", "gaussian", 1.0, 2, "decoupled" });
% 
% % convergence parameters
% N_iters    =    10; % Maximum number of Newton steps
% resnrmdrop = 1e-09; % Newton convergence criteria

del    = 0.2;
h      = [del del/2 del/4 del/8];
L2_p2  = [5.152661e-02 9.918104e-03 2.935698e-03 7.070890e-04];
L2_p2_1em4  = [0.051548827215790 0.009916565074277 0.002945711425439 8.744870950362990e-04];
y_vals2= 0.1*h.^2;

figure(1)
clf
hold on
plot(h, L2_p2,'--*r','LineWidth', 2);
plot(h, L2_p2_1em4,'--*b','LineWidth', 2);
plot(h,y_vals2,'-k','LineWidth', 2);
set(gca, 'XScale', 'log', 'YScale', 'log');
xlabel('h','Interpreter','latex'); ylabel('$L_2$','Interpreter','latex');
legend('RBF$(C^2)$, coupled','RBF$(C^2)$, tol=1e-04','slope=2','Interpreter','latex');
set(gcf,'color','w');
set(gca, 'FontSize', 18);

L2_C2_hp2 = [0.111185401437300,0.0686941869452710,0.0681288190682004,0.0560122111260676,0.0566958407943873,0.0528484946508973,0.0532169058847265,0.0519510325673926,0.0520934570342101,0.0516680991851441,0.0517186119779739,0.0515744421926258,0.0515918796179365,0.0515428613235235,0.0515488272157900,0.0515321425664045,0.0515341775302890,0.0515284963450578,0.0515291897591935,0.0515272550465859,0.0515274912451104,0.0515268323550703,0.0515269128021149,0.0515266884057147,0.0515267158041300,0.0515266393816671,0.0515266487128094,0.0515266226856410,0.0515266258635550,0.0515266169994872,0.0515266180817900,0.0515266150629554,0.0515266154315553,0.0515266144034311,0.0515266145289652,0.0515266141788170,0.0515266142215701,0.0515266141023202,0.0515266141168807,0.0515266140762677,0.0515266140812265,0.0515266140673950,0.0515266140690838,0.0515266140643732,0.0515266140649484,0.0515266140633441,0.0515266140635400,0.0515266140629936,0.0515266140630603,0.0515266140628742,0.0515266140628969,0.0515266140628336,0.0515266140628413,0.0515266140628197,0.0515266140628224,0.0515266140628150,0.0515266140628159,0.0515266140628134,0.0515266140628138,0.0515266140628128,0.0515266140628130,0.0515266140628127,0.0515266140628127,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628125,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126,0.0515266140628126];
L2_C2_hp1 = [0.0930988430622235,0.0665501374817493,0.0531333037032679,0.0429427610956081,0.0345882614555620,0.0286120419337310,0.0233720839949760,0.0199071573988117,0.0167258159003750,0.0148570779559416,0.0130527004846358,0.0121610129736808,0.0112204790300622,0.0108585555050914,0.0104000538864896,0.0102829984156859,0.0100661234491174,0.0100456974419397,0.00994280186585982,0.00995390024553611,0.00990383228468514,0.00992139114297127,0.00989607622745086,0.00991182560157430,0.00989844503080072,0.00991048998845947,0.00990309470750287,0.00991167490266841,0.00990741918022674,0.00991330675509680,0.00991077420747525,0.00991472846016742,0.00991318166933887,0.00991580346640394,0.00991484051902438,0.00991656507427656,0.00991595744779656,0.00991708615473643,0.00991669916423271,0.00991743554565469,0.00991718752923258,0.00991766697458819,0.00991750736159707,0.00991781911116955,0.00991771610849410,0.00991791864586076,0.00991785205557166,0.00991798356803968,0.00991794046733796,0.00991802583138082,0.00991799791295845,0.00991805330960270,0.00991803521645381,0.00991807116053764,0.00991805943106910,0.00991808275112318,0.00991807514551345,0.00991809027431651,0.00991808534202018,0.00991809515638050,0.00991809195746434,0.00991809832407106,0.00991809624924552,0.00991810037921317,0.00991809903342545,0.00991810171247335,0.00991810083953803,0.00991810257738366,0.00991810201115167,0.00991810313845267,0.00991810277116089,0.00991810350241327,0.00991810326416438,0.00991810373850884,0.00991810358396476,0.00991810389165931,0.00991810379141146,0.00991810399100451,0.00991810392597679,0.00991810405544728,0.00991810401326571,0.00991810409724963,0.00991810406988769,0.00991810412436568,0.00991810410661679,0.00991810414195514,0.00991810413044193,0.00991810415336492,0.00991810414589664,0.00991810416076614,0.00991810415592165,0.00991810416556710,0.00991810416242464,0.00991810416868134,0.00991810416664292,0.00991810417070146,0.00991810416937919,0.00991810417201186,0.00991810417115415,0.00991810417286188,0.00991810417230551,0.00991810417341327,0.00991810417305236,0.00991810417377093,0.00991810417353682,0.00991810417400294,0.00991810417385107,0.00991810417415344,0.00991810417405494,0.00991810417425106,0.00991810417418717,0.00991810417431438,0.00991810417427292,0.00991810417435546,0.00991810417432858,0.00991810417438211,0.00991810417436466,0.00991810417439939,0.00991810417438808,0.00991810417441060];
L2_C2_hp05 = [0.108872378292197,0.0716581409843094,0.0731566866700331,0.0509826853166998,0.0542561028522759,0.0381534809230521,0.0415851252455452,0.0293066534787208,0.0325644159896145,0.0229811093455545,0.0259091936825891,0.0183239049220833,0.0208723245403704,0.0148093337550688,0.0169897952272323,0.0121075975482713,0.0139593948354851,0.0100059825812299,0.0115756386093749,0.00836178641461778,0.00969311000927417,0.00707479755304768,0.00820513313485946,0.00607126416064889,0.00703095600060575,0.00529444185952012,0.00610777680105078,0.00469895550953250,0.00538563026550981,0.00424748519232337,0.00482405585021889,0.00390892990102055,0.00438993250477700,0.00365746239348537,0.00405607983617497,0.00347200483764174,0.00380032465634694,0.00333578853724760,0.00360480401565374,0.00323583589267339,0.00345535773618969,0.00316235344864808,0.00334094619583215,0.00310810018412533,0.00325308890524217,0.00306780123049459,0.00318534585660252,0.00303765014641285,0.00313286419848405,0.00301491299139857,0.00309200174346384,0.00299762756296105,0.00306002700037976,0.00298438208121382,0.00303488756704440,0.00297415576220755,0.00301503526905246,0.00296620550824884,0.00299929609740863,0.00295998598547464,0.00298677432195707,0.00295509342899212,0.00297678208623293,0.00295122612001898,0.00296878772621020,0.00294815650501816,0.00296237773328088,0.00294571142543920,0.00295722862452109,0.00294375800168161,0.00295308600766645,0.00294219347104893,0.00294974888641079,0.00294093780479035,0.00294705780210295,0.00293992829158875,0.00294488580285390,0.00293911552369938,0.00294313151259074,0.00293846039268661,0.00294171377278956,0.00293793181898350,0.00294056747208575,0.00293750502028664,0.00293964028067997,0.00293716017970491,0.00293889007947132,0.00293688141349848,0.00293828292661989,0.00293665596553532,0.00293779144269260,0.00293647357489002,0.00293739352381377,0.00293632597678339,0.00293707131321800,0.00293620650699017,0.00293681037731732,0.00293610978707573,0.00293659904427502,0.00293603147314844,0.00293642787214332,0.00293596805477612,0.00293628922059178,0.00293591669369482,0.00293617690565767,0.00293587509419787,0.00293608592116367,0.00293584139882565,0.00293601221375775,0.00293581410431293,0.00293595250114046,0.00293579199379062,0.00293590412511368,0.00293577408205346,0.00293586493273114,0.00293575957134520,0.00293583318014402,0.00293574781562079,0.00293580745478680,0.00293573829164699];
L2_C2_hp025 = [0.116160955553106,0.0966550919124544,0.0962366682772385,0.0817324949838165,0.0838119009650016,0.0711097663591314,0.0737838821608827,0.0623420607678322,0.0652396865476925,0.0548766015708811,0.0578541622468741,0.0484596836964612,0.0514248412216742,0.0429124392298928,0.0457990460560758,0.0380932629273440,0.0408556019851734,0.0338875924478768,0.0364964170252739,0.0302022612746206,0.0326410473274240,0.0269611533117610,0.0292227930265073,0.0241016992958935,0.0261857994814083,0.0215720887683794,0.0234828709473100,0.0193290822804060,0.0210738020819901,0.0173363069286102,0.0189240910517496,0.0155629306159691,0.0170039368756133,0.0139826287571923,0.0152874504828244,0.0125727753222139,0.0137520278286224,0.0113138056682732,0.0123778468806945,0.0101887110703607,0.0111474600250764,0.00918263451952756,0.0100454605540336,0.00828254472736100,0.00905820713893877,0.00747697085133380,0.00817359407604410,0.00675578466004332,0.00738085798719707,0.00611002002270057,0.00667041382249085,0.00553172199019133,0.00603371463736410,0.00501381953050998,0.00546313084177762,0.00455001733637362,0.00495184554623266,0.00413470314787552,0.00449376333439235,0.00376286781107004,0.00408343033124121,0.00343003588656674,0.00371596385099634,0.00313220507710708,0.00338699023165102,0.00286579309451739,0.00309258971643962,0.00262759086029124,0.00282924744407552,0.00241472114951139,0.00259380977222760,0.00222460195881838,0.00238344529175822,0.00205491401557563,0.00219560999936307,0.00190357195405625,0.00202801618778533,0.00176869876982225,0.00187860468826525,0.00164860322833500,0.00174552016048839,0.00154175995022135,0.00162708917129747,0.00144679192541677,0.00152180083486851,0.00136245522404427,0.00142828980438456,0.00128762567674266,0.00134532140998919,0.00122128729560586,0.00127177873294457,0.00116252220391060,0.00120665139585493,0.00111050184322319,0.00114902583885288,0.00106447923405880,0.00109807684703165,0.00102378208297278,0.00105306009921219,0.000987806554588361,0.00101330552432069,0.000956011559430462,0.000978211278673489,0.000927913444067539,0.000947238192514025,0.000903081005093034,0.000919904572986622,0.000881130779515555,0.000895781288781470,0.000861722588855944,0.000874487095036299,0.000844555331657343,0.000855684183155743,0.000829363029383758,0.000839073957984927,0.000815911134863406,0.000824393054598749,0.000803993112039508,0.000811409610150002,0.000793427292435608];

iterations = 1:length(L2_C2_hp025);
oneD_arr = ones(length(L2_C2_hp025));
y_vals = h.^2;

figure(2)
clf
h1 = plot3(iterations,0.2*oneD_arr,L2_C2_hp2,'--*r','LineWidth', 2);
hold on
h2 = plot3(iterations,0.1*oneD_arr,L2_C2_hp1,'--*m','LineWidth', 2);
h3 = plot3(iterations,0.05*oneD_arr,L2_C2_hp05,'--*b','LineWidth', 2);
h4 = plot3(iterations,0.025*oneD_arr,L2_C2_hp025,'--*c','LineWidth', 2);
h5 = plot3([40  40  40  40],h,1.3*h.^2,'-k','LineWidth', 2);
plot3([80 80 80 80],h,1.3*h.^2,'-k','LineWidth', 2);
plot3([120 120 120 120],h,1.3*h.^2,'-k','LineWidth', 2);
grid on;
set(gca, 'YScale', 'log', 'ZScale', 'log');
xlabel('decoupled iterations','Interpreter','latex'); ylabel('h','Interpreter','latex'); zlabel('$L_2$','Interpreter','latex');
legend([h1(1),h2(1),h3(1),h4(1),h5(1)], 'h = 0.2','h = 0.1','h = 0.05','h = 0.025','slope=2','Interpreter','latex');
set(gcf,'color','w');
set(gca, 'FontSize', 18);
view(176,20.6);

% fig = figure(2);
% set(fig,'Units','Inches');
% pos = get(fig,'Position');
% set(fig,'PaperPositionMode','Auto','PaperUnits','Inches','PaperSize',[pos(3), pos(4)])
% print(fig,'iterations_error_tradeoff','-dpdf','-r0')